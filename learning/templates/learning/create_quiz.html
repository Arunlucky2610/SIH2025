{% extends 'learning/base.html' %}
{% load static %}

{% block title %}
    {% if quiz_type == 'quick' %}Create Quick Quiz{% else %}Schedule Quiz{% endif %} - Rural Digital Learning
{% endblock %}

{% block extra_css %}
<style>
    body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
    }
    
    .quiz-container {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        margin: 2rem auto;
        max-width: 900px;
    }
    
    .quiz-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 2rem;
        border-radius: 20px 20px 0 0;
        text-align: center;
    }
    
    .question-card {
        background: #f8f9fa;
        border: 2px solid #e9ecef;
        border-radius: 15px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        transition: all 0.3s ease;
    }
    
    .question-card:hover {
        border-color: #667eea;
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.1);
    }
    
    .question-header {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        padding: 0.75rem 1rem;
        border-radius: 10px;
        margin-bottom: 1rem;
        font-weight: bold;
    }
    
    .option-group {
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 0.75rem;
        margin-bottom: 0.5rem;
        transition: all 0.2s ease;
    }
    
    .option-group:focus-within {
        border-color: #667eea;
        box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
    }
    
    .btn-add-question {
        background: linear-gradient(135deg, #28a745, #20c997);
        border: none;
        border-radius: 25px;
        padding: 0.75rem 2rem;
        color: white;
        font-weight: bold;
        transition: all 0.3s ease;
    }
    
    .btn-add-question:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
        color: white;
    }
    
    .btn-remove-question {
        background: linear-gradient(135deg, #dc3545, #c82333);
        border: none;
        border-radius: 20px;
        padding: 0.5rem 1rem;
        color: white;
        font-size: 0.875rem;
    }
    
    .btn-submit-quiz {
        background: linear-gradient(135deg, #667eea, #764ba2);
        border: none;
        border-radius: 25px;
        padding: 1rem 3rem;
        color: white;
        font-weight: bold;
        font-size: 1.1rem;
        transition: all 0.3s ease;
    }
    
    .btn-submit-quiz:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        color: white;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="quiz-container">
        <div class="quiz-header">
            <h1 class="display-5 fw-bold mb-2">
                <i class="bi bi-{% if quiz_type == 'quick' %}lightning-fill{% else %}calendar-check{% endif %} me-3"></i>
                {% if quiz_type == 'quick' %}Create Quick Quiz{% else %}Schedule Quiz{% endif %}
            </h1>
            <p class="lead mb-0">
                {% if quiz_type == 'quick' %}
                    Create an instant quiz for immediate student assessment
                {% else %}
                    Schedule a quiz assignment with specific timing and deadlines
                {% endif %}
            </p>
        </div>
        
        <div class="p-4">
            <form method="post" id="quizForm">
                {% csrf_token %}
                
                <!-- Quiz Basic Information -->
                <div class="row mb-4">
                    <div class="col-md-8">
                        <div class="mb-3">
                            <label for="quiz_title" class="form-label fw-bold">
                                <i class="bi bi-card-text me-2"></i>Quiz Title
                            </label>
                            <input type="text" class="form-control form-control-lg" id="quiz_title" name="quiz_title" placeholder="Enter quiz title..." required>
                        </div>
                    </div>
                    <div class="col-md-4">
                        {% if quiz_type == 'schedule' %}
                        <div class="mb-3">
                            <label for="quiz_duration" class="form-label fw-bold">
                                <i class="bi bi-clock me-2"></i>Duration (minutes)
                            </label>
                            <input type="number" class="form-control form-control-lg" id="quiz_duration" name="quiz_duration" min="15" max="180" value="60">
                        </div>
                        {% endif %}
                    </div>
                </div>
                
                <div class="mb-4">
                    <label for="quiz_description" class="form-label fw-bold">
                        <i class="bi bi-chat-text me-2"></i>Description (Optional)
                    </label>
                    <textarea class="form-control" id="quiz_description" name="quiz_description" rows="3" placeholder="Brief description of the quiz..."></textarea>
                </div>
                
                {% if quiz_type == 'schedule' %}
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="schedule_date" class="form-label fw-bold">
                                <i class="bi bi-calendar me-2"></i>Schedule Date
                            </label>
                            <input type="date" class="form-control" id="schedule_date" name="schedule_date">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="schedule_time" class="form-label fw-bold">
                                <i class="bi bi-clock me-2"></i>Schedule Time
                            </label>
                            <input type="time" class="form-control" id="schedule_time" name="schedule_time">
                        </div>
                    </div>
                </div>
                {% endif %}
                
                <!-- Questions Section -->
                <div class="mb-4">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h4 class="fw-bold">
                            <i class="bi bi-question-circle me-2"></i>Quiz Questions
                        </h4>
                        <button type="button" class="btn btn-add-question" onclick="addQuestion()">
                            <i class="bi bi-plus-circle me-2"></i>Add Question
                        </button>
                    </div>
                    
                    <div id="questionsContainer">
                        <!-- Questions will be added here dynamically -->
                    </div>
                </div>
                
                <!-- Submit Section -->
                <div class="text-center">
                    <a href="{% url 'teacher_home' %}" class="btn btn-secondary btn-lg me-3">
                        <i class="bi bi-arrow-left me-2"></i>Back to Home
                    </a>
                    <button type="submit" class="btn btn-submit-quiz">
                        <i class="bi bi-check-circle me-2"></i>
                        {% if quiz_type == 'quick' %}Create Quiz{% else %}Schedule Quiz{% endif %}
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
let questionCount = 0;

function addQuestion() {
    questionCount++;
    const container = document.getElementById('questionsContainer');
    
    const questionHtml = `
        <div class="question-card" id="question_${questionCount}">
            <div class="question-header d-flex justify-content-between align-items-center">
                <span><i class="bi bi-question-circle me-2"></i>Question ${questionCount}</span>
                <button type="button" class="btn btn-remove-question btn-sm" onclick="removeQuestion(${questionCount})">
                    <i class="bi bi-trash me-1"></i>Remove
                </button>
            </div>
            
            <div class="mb-3">
                <label class="form-label fw-bold">Question Text</label>
                <textarea class="form-control" name="question_${questionCount}" placeholder="Enter your question here..." rows="3" required></textarea>
            </div>
            
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label class="form-label fw-bold">Option A</label>
                    <div class="option-group">
                        <input type="text" class="form-control border-0" name="option_a_${questionCount}" placeholder="Enter option A..." required>
                    </div>
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label fw-bold">Option B</label>
                    <div class="option-group">
                        <input type="text" class="form-control border-0" name="option_b_${questionCount}" placeholder="Enter option B..." required>
                    </div>
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label fw-bold">Option C</label>
                    <div class="option-group">
                        <input type="text" class="form-control border-0" name="option_c_${questionCount}" placeholder="Enter option C..." required>
                    </div>
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label fw-bold">Option D</label>
                    <div class="option-group">
                        <input type="text" class="form-control border-0" name="option_d_${questionCount}" placeholder="Enter option D..." required>
                    </div>
                </div>
            </div>
            
            <div class="mb-3">
                <label class="form-label fw-bold text-success">
                    <i class="bi bi-check-circle me-1"></i>Correct Answer
                </label>
                <select class="form-select" name="correct_answer_${questionCount}" required>
                    <option value="">Select the correct answer...</option>
                    <option value="A">Option A</option>
                    <option value="B">Option B</option>
                    <option value="C">Option C</option>
                    <option value="D">Option D</option>
                </select>
            </div>
        </div>
    `;
    
    container.insertAdjacentHTML('beforeend', questionHtml);
}

function removeQuestion(questionNum) {
    const questionElement = document.getElementById(`question_${questionNum}`);
    if (questionElement) {
        questionElement.remove();
    }
}

// Add first question automatically
document.addEventListener('DOMContentLoaded', function() {
    addQuestion();
});

// Form validation
document.getElementById('quizForm').addEventListener('submit', function(e) {
    const questions = document.querySelectorAll('.question-card');
    if (questions.length === 0) {
        e.preventDefault();
        alert('Please add at least one question to the quiz.');
        return;
    }
    
    let allValid = true;
    questions.forEach(question => {
        const inputs = question.querySelectorAll('input[required], textarea[required], select[required]');
        inputs.forEach(input => {
            if (!input.value.trim()) {
                allValid = false;
                input.focus();
                return;
            }
        });
    });
    
    if (!allValid) {
        e.preventDefault();
        alert('Please fill in all required fields for all questions.');
    }
});
</script>
{% endblock %}