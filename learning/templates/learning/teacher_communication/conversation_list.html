{% extends 'learning/base.html' %}
{% load static %}

{% block title %}Conversation History{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/ultra-modern.css' %}">
<style>
.conversation-list-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 2rem;
    border-radius: 20px;
    margin-bottom: 2rem;
    text-align: center;
    box-shadow: 0 8px 32px rgba(102, 126, 234, 0.3);
}

.conversation-card {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border-radius: 20px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    transition: all 0.3s ease;
    cursor: pointer;
}

.conversation-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 48px rgba(0, 0, 0, 0.15);
}

.conversation-header {
    display: flex;
    justify-content: between;
    align-items: flex-start;
    margin-bottom: 1rem;
}

.conversation-title {
    font-weight: 600;
    color: #2c3e50 !important;
    font-size: 1.1rem;
    margin-bottom: 0.5rem;
}

.conversation-participants {
    color: #4a69bd !important;
    font-size: 0.9rem;
    margin-bottom: 0.5rem;
    font-weight: 500;
}

.conversation-student {
    color: #7f8c8d !important;
    font-size: 0.9rem;
}

.conversation-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px solid #e9ecef;
}

.last-message-time {
    color: #95a5a6 !important;
    font-size: 0.8rem;
    font-weight: 500;
}

/* Enhanced visibility for gradient theme */
body.gradient-theme .conversation-title {
    color: #2c3e50 !important;
}

body.gradient-theme .conversation-participants {
    color: #4a69bd !important;
}

body.gradient-theme .conversation-student {
    color: #7f8c8d !important;
}

body.gradient-theme .last-message-time {
    color: #95a5a6 !important;
}

.unread-badge {
    background: #e74c3c;
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
}

.message-count {
    background: #667eea;
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 500;
}

.no-conversations {
    text-align: center;
    padding: 3rem;
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    color: white;
    border-radius: 20px;
}

.filter-tabs {
    display: flex;
    gap: 1rem;
    margin-bottom: 2rem;
    background: rgba(255, 255, 255, 0.9);
    padding: 0.5rem;
    border-radius: 15px;
    backdrop-filter: blur(20px);
}

.filter-tab {
    flex: 1;
    padding: 0.75rem 1rem;
    background: transparent;
    border: none;
    border-radius: 10px;
    font-weight: 600;
    transition: all 0.3s ease;
    cursor: pointer;
}

.filter-tab.active {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.conversation-status {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-top: 0.5rem;
}

.status-indicator {
    width: 8px;
    height: 8px;
    border-radius: 50%;
}

.status-active { background: #28a745; }
.status-waiting { background: #ffc107; }
.status-resolved { background: #6c757d; }

.quick-actions {
    display: flex;
    gap: 1rem;
    margin-bottom: 2rem;
}

.action-btn {
    flex: 1;
    padding: 1rem;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    border-radius: 15px;
    font-weight: 600;
    text-decoration: none;
    text-align: center;
    transition: all 0.3s ease;
}

.action-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
    color: white;
    text-decoration: none;
}
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="conversation-list-header">
        <h1>💬 Your Conversations</h1>
        <p>All your conversations with teachers</p>
        <a href="{% url 'teacher_communication_dashboard' %}" class="btn btn-outline-light">
            <i class="fas fa-arrow-left"></i> Back to Dashboard
        </a>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <button class="action-btn" onclick="openNewMessageModal()">
            <i class="fas fa-plus"></i> Start New Message
        </button>
        <button class="action-btn" onclick="markAllRead()">
            <i class="fas fa-check-double"></i> Mark All as Read
        </button>
        <button class="action-btn" onclick="showAdvancedSearch()">
            <i class="fas fa-search"></i> Advanced Search
        </button>
        <button class="action-btn" onclick="exportConversations()">
            <i class="fas fa-download"></i> Export History
        </button>
    </div>

    <!-- Filter Tabs -->
    <div class="filter-tabs">
        <button class="filter-tab active" onclick="filterConversations('all')">
            All Conversations
        </button>
        <button class="filter-tab" onclick="filterConversations('unread')">
            Unread Messages
        </button>
        <button class="filter-tab" onclick="filterConversations('recent')">
            Recent Activity
        </button>
        <button class="filter-tab" onclick="filterConversations('resolved')">
            Resolved
        </button>
    </div>

    <!-- Conversations List -->
    {% if conversations %}
        <div id="conversations-container">
            {% for conversation in conversations %}
                <div class="conversation-card" data-conversation-id="{{ conversation.id }}" data-filter="all {% if conversation.unread_count > 0 %}unread{% endif %}">
                    <div class="conversation-header">
                        <div class="flex-grow-1">
                            <div class="conversation-title">
                                {{ conversation.subject }}
                            </div>
                            <div class="conversation-participants">
                                <i class="fas fa-users"></i>
                                {% for participant in conversation.participants.all %}
                                    {{ participant.get_full_name|default:participant.username }}{% if not forloop.last %}, {% endif %}
                                {% endfor %}
                            </div>
                            <div class="conversation-student">
                                <i class="fas fa-user-graduate"></i>
                                About: {{ conversation.student.get_full_name|default:conversation.student.username }}
                            </div>
                            <div class="conversation-status">
                                <div class="status-indicator {% if conversation.is_active %}status-active{% else %}status-resolved{% endif %}"></div>
                                <span class="small">{{ conversation.is_active|yesno:"Active,Resolved" }}</span>
                            </div>
                        </div>
                        <div class="text-end">
                            {% if conversation.unread_count > 0 %}
                                <div class="unread-badge">{{ conversation.unread_count }} new</div>
                            {% endif %}
                            <div class="message-count mt-2">{{ conversation.message_count }} messages</div>
                        </div>
                    </div>
                    
                    <div class="conversation-meta">
                        <div class="last-message-time">
                            <i class="fas fa-clock"></i>
                            Last activity: {{ conversation.last_message_at|timesince }} ago
                        </div>
                        <div>
                            <button class="btn btn-sm btn-outline-primary view-conversation-btn" data-conversation-id="{{ conversation.id }}">
                                <i class="fas fa-eye"></i> View
                            </button>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>

        <!-- Load More Button (for pagination) -->
        <div class="text-center mt-4">
            <button class="btn btn-outline-primary" onclick="loadMoreConversations()">
                <i class="fas fa-arrow-down"></i> Load More Conversations
            </button>
        </div>

    {% else %}
        <div class="no-conversations">
            <i class="fas fa-comments fa-3x mb-3"></i>
            <h3>No Conversations Yet</h3>
            <p>You haven't started any conversations with teachers yet.</p>
            <p>Start communicating with your child's teachers to stay involved in their learning journey!</p>
            <a href="{% url 'teacher_communication_dashboard' %}" class="btn btn-light btn-lg mt-3">
                <i class="fas fa-plus"></i> Start Your First Conversation
            </a>
        </div>
    {% endif %}
</div>

<script>
function openConversation(conversationId) {
    window.location.href = `/teacher-communication/conversation/${conversationId}/`;
}

function filterConversations(filter) {
    // Update active tab
    document.querySelectorAll('.filter-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    event.target.classList.add('active');
    
    // Filter conversations
    const conversations = document.querySelectorAll('.conversation-card');
    conversations.forEach(card => {
        if (filter === 'all') {
            card.style.display = 'block';
        } else if (filter === 'unread') {
            if (card.dataset.filter.includes('unread')) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        } else if (filter === 'recent') {
            // Show conversations from last 7 days
            card.style.display = 'block'; // Simplified for now
        } else if (filter === 'resolved') {
            // Show resolved conversations
            card.style.display = 'none'; // Most conversations are active for now
        }
    });
}

function markAllRead() {
    if (confirm('Mark all conversations as read?')) {
        fetch('/teacher-communication/mark-all-read/', {
            method: 'POST',
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                'Content-Type': 'application/json',
            },
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                // Remove unread badges
                document.querySelectorAll('.unread-badge').forEach(badge => {
                    badge.remove();
                });
                alert('All messages marked as read!');
            } else {
                alert('Error marking messages as read.');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error marking messages as read.');
        });
    }
}

function showFilters() {
    alert('Advanced filters coming soon! You can use the tabs above for basic filtering.');
}

function loadMoreConversations() {
    // Implement pagination
    alert('Load more functionality coming soon!');
}

// Auto-refresh every 30 seconds to check for new messages
setInterval(function() {
    // You can implement AJAX call to check for new messages
    // and update the conversation list without full page reload
}, 30000);

// Enhanced functionalities for SIH Demo
// Enhanced functionalities for SIH Demo
function openNewMessageModal() {
    const modal = new bootstrap.Modal(document.getElementById('newMessageModal'));
    modal.show();
    
    // Initialize character counter
    const messageContent = document.getElementById('messageContent');
    const charCount = document.getElementById('charCount');
    
    messageContent.addEventListener('input', function() {
        charCount.textContent = this.value.length;
        if (this.value.length > 1000) {
            charCount.style.color = 'red';
        } else {
            charCount.style.color = '#6c757d';
        }
    });
}

function fillMessageTemplate(type) {
    const messageContent = document.getElementById('messageContent');
    const messageSubject = document.getElementById('messageSubject');
    
    const templates = {
        'academic': {
            subject: 'Academic Progress Discussion',
            content: 'Dear Teacher,\n\nI hope this message finds you well. I would like to discuss my child\'s academic progress in your subject. I have noticed some areas where they might need additional support, and I would appreciate your guidance on how we can work together to help them improve.\n\nThank you for your dedication to our children\'s education.\n\nBest regards'
        },
        'meeting': {
            subject: 'Parent-Teacher Meeting Request',
            content: 'Dear Teacher,\n\nI hope you are doing well. I would like to schedule a parent-teacher meeting to discuss my child\'s progress and any concerns you might have. Please let me know your available time slots, and I will adjust my schedule accordingly.\n\nLooking forward to hearing from you.\n\nBest regards'
        },
        'homework': {
            subject: 'Homework Support Request',
            content: 'Dear Teacher,\n\nI hope this message finds you well. My child has been struggling with some of the recent homework assignments. Could you please provide some additional guidance or resources that might help them understand the concepts better?\n\nI would be grateful for any suggestions you might have.\n\nThank you for your support.'
        },
        'appreciation': {
            subject: 'Thank You for Your Dedication',
            content: 'Dear Teacher,\n\nI wanted to take a moment to express my sincere gratitude for your dedication and hard work in teaching my child. Your efforts have made a significant positive impact on their learning and development.\n\nThank you for being such an inspiring educator.\n\nWith appreciation'
        }
    };
    
    if (templates[type]) {
        messageSubject.value = templates[type].subject;
        messageContent.value = templates[type].content;
        
        // Update character count
        document.getElementById('charCount').textContent = templates[type].content.length;
    }
}

function showAdvancedSearch() {
    const modal = new bootstrap.Modal(document.getElementById('advancedSearchModal'));
    modal.show();
}

function applyAdvancedSearch() {
    const searchCriteria = {
        teacher: document.getElementById('searchTeacher').value,
        subject: document.getElementById('searchSubject').value,
        dateFrom: document.getElementById('dateFrom').value,
        dateTo: document.getElementById('dateTo').value,
        status: document.getElementById('searchStatus').value,
        priority: document.getElementById('searchPriority').value
    };
    
    // Apply search filter to conversation cards
    const conversationCards = document.querySelectorAll('.conversation-card');
    let visibleCount = 0;
    
    conversationCards.forEach(card => {
        let shouldShow = true;
        
        // Apply filters based on search criteria
        if (searchCriteria.subject && !card.textContent.toLowerCase().includes(searchCriteria.subject.toLowerCase())) {
            shouldShow = false;
        }
        
        if (searchCriteria.status === 'unread' && !card.classList.contains('unread')) {
            shouldShow = false;
        }
        
        if (shouldShow) {
            card.style.display = 'block';
            visibleCount++;
        } else {
            card.style.display = 'none';
        }
    });
    
    // Show search results count
    alert(`Found ${visibleCount} conversations matching your criteria.`);
    
    // Close modal
    bootstrap.Modal.getInstance(document.getElementById('advancedSearchModal')).hide();
}

function sendNewMessage() {
    const teacher = document.getElementById('teacherSelect').value;
    const priority = document.getElementById('prioritySelect').value;
    const subject = document.getElementById('messageSubject').value;
    const content = document.getElementById('messageContent').value;
    const category = document.getElementById('categorySelect').value;
    
    if (!teacher || !subject || !content) {
        alert('Please fill in all required fields (Teacher, Subject, and Message).');
        return;
    }
    
    if (content.length > 1000) {
        alert('Message is too long. Please keep it under 1000 characters.');
        return;
    }
    
    // Simulate sending message
    const loadingBtn = event.target;
    loadingBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Sending...';
    loadingBtn.disabled = true;
    
    setTimeout(() => {
        alert('Message sent successfully! The teacher will be notified and will respond soon.');
        
        // Close modal
        bootstrap.Modal.getInstance(document.getElementById('newMessageModal')).hide();
        
        // Reset form
        document.getElementById('teacherSelect').value = '';
        document.getElementById('messageSubject').value = '';
        document.getElementById('messageContent').value = '';
        document.getElementById('charCount').textContent = '0';
        
        // Reset button
        loadingBtn.innerHTML = '<i class="fas fa-paper-plane me-2"></i>Send Message';
        loadingBtn.disabled = false;
        
        // Add new conversation to the list (demo)
        addNewConversationToList(teacher, subject, priority, category);
        
    }, 2000);
}

function addNewConversationToList(teacher, subject, priority, category) {
    const conversationsContainer = document.getElementById('conversations-container');
    const teacherNames = {
        'math_teacher': 'Mrs. Sharma - Mathematics',
        'science_teacher': 'Mr. Kumar - Science',
        'english_teacher': 'Ms. Patel - English',
        'hindi_teacher': 'Mrs. Singh - Hindi',
        'social_teacher': 'Mr. Gupta - Social Studies',
        'art_teacher': 'Ms. Kaur - Arts & Crafts'
    };
    
    const priorityColors = {
        'low': 'success',
        'medium': 'warning', 
        'high': 'orange',
        'urgent': 'danger'
    };
    
    const newConversationHTML = `
        <div class="conversation-card" onclick="openConversation('new')" data-filter="all unread" style="border-left: 4px solid #667eea;">
            <div class="conversation-header">
                <div class="flex-grow-1">
                    <div class="conversation-title">${subject}</div>
                    <div class="conversation-participants">
                        <i class="fas fa-users"></i> ${teacherNames[teacher] || teacher}
                    </div>
                    <div class="conversation-student">
                        <i class="fas fa-user-graduate"></i> About: Your Child
                    </div>
                    <div class="conversation-status">
                        <span class="badge bg-${priorityColors[priority]} me-2">${priority.toUpperCase()}</span>
                        <span class="badge bg-secondary">${category.toUpperCase()}</span>
                    </div>
                </div>
                <div class="conversation-meta">
                    <div class="text-end">
                        <div class="last-message-time">Just now</div>
                        <span class="unread-badge">New</span>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    conversationsContainer.insertAdjacentHTML('afterbegin', newConversationHTML);
}

function exportConversations() {
    alert('Exporting conversation history... This feature helps you keep records for meetings and follow-ups.');
    
    // Simulate export process
    setTimeout(() => {
        alert('Export completed! Your conversation history has been saved as PDF.');
    }, 2000);
}

// Language button functionality
document.addEventListener('DOMContentLoaded', function() {
    const languageButtons = document.querySelectorAll('.language-btn');
    languageButtons.forEach(btn => {
        btn.addEventListener('click', function() {
            languageButtons.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
        });
    });
    
    // Conversation card click handlers
    document.querySelectorAll('.conversation-card').forEach(card => {
        card.addEventListener('click', function() {
            const conversationId = this.getAttribute('data-conversation-id');
            if (conversationId) {
                openConversation(conversationId);
            }
        });
    });
    
    // View button click handlers
    document.querySelectorAll('.view-conversation-btn').forEach(btn => {
        btn.addEventListener('click', function(event) {
            event.stopPropagation();
            const conversationId = this.getAttribute('data-conversation-id');
            if (conversationId) {
                openConversation(conversationId);
            }
        });
    });
    
    // Suggestion card hover effects
    const suggestionCards = document.querySelectorAll('.suggestion-card');
    suggestionCards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-5px) scale(1.02)';
        });
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0) scale(1)';
        });
    });
});
</script>

<!-- Advanced New Message Modal -->
<div class="modal fade" id="newMessageModal" tabindex="-1" aria-labelledby="newMessageModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content" style="border-radius: 20px; border: none; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
            <div class="modal-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 20px 20px 0 0; color: white;">
                <h5 class="modal-title" id="newMessageModalLabel">
                    <i class="fas fa-paper-plane me-2"></i>Start New Conversation with Teacher
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-4">
                <!-- Teacher Selection -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <label for="teacherSelect" class="form-label fw-bold">
                            <i class="fas fa-chalkboard-teacher text-primary me-2"></i>Select Teacher
                        </label>
                        <select id="teacherSelect" class="form-select" style="border-radius: 15px; border: 2px solid #e9ecef;">
                            <option value="">Choose a teacher...</option>
                            <option value="math_teacher">Mrs. Sharma - Mathematics</option>
                            <option value="science_teacher">Mr. Kumar - Science</option>
                            <option value="english_teacher">Ms. Patel - English</option>
                            <option value="hindi_teacher">Mrs. Singh - Hindi</option>
                            <option value="social_teacher">Mr. Gupta - Social Studies</option>
                            <option value="art_teacher">Ms. Kaur - Arts & Crafts</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label for="prioritySelect" class="form-label fw-bold">
                            <i class="fas fa-exclamation-triangle text-warning me-2"></i>Priority Level
                        </label>
                        <select id="prioritySelect" class="form-select" style="border-radius: 15px; border: 2px solid #e9ecef;">
                            <option value="low">🟢 Low - General Inquiry</option>
                            <option value="medium" selected>🟡 Medium - Regular Update</option>
                            <option value="high">🟠 High - Needs Attention</option>
                            <option value="urgent">🔴 Urgent - Immediate Response Required</option>
                        </select>
                    </div>
                </div>

                <!-- Subject and Category -->
                <div class="row mb-4">
                    <div class="col-md-8">
                        <label for="messageSubject" class="form-label fw-bold">
                            <i class="fas fa-tag text-info me-2"></i>Subject
                        </label>
                        <input type="text" id="messageSubject" class="form-control" placeholder="Enter message subject..." style="border-radius: 15px; border: 2px solid #e9ecef;">
                    </div>
                    <div class="col-md-4">
                        <label for="categorySelect" class="form-label fw-bold">
                            <i class="fas fa-folder text-success me-2"></i>Category
                        </label>
                        <select id="categorySelect" class="form-select" style="border-radius: 15px; border: 2px solid #e9ecef;">
                            <option value="academic">📚 Academic Performance</option>
                            <option value="behavior">👨‍👩‍👧‍👦 Behavior & Discipline</option>
                            <option value="attendance">📅 Attendance & Punctuality</option>
                            <option value="homework">📝 Homework & Assignments</option>
                            <option value="health">🏥 Health & Wellbeing</option>
                            <option value="general">💬 General Discussion</option>
                        </select>
                    </div>
                </div>

                <!-- Smart Suggestions -->
                <div class="mb-4">
                    <label class="form-label fw-bold">
                        <i class="fas fa-lightbulb text-warning me-2"></i>Smart Message Suggestions
                    </label>
                    <div class="suggestion-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                        <div class="suggestion-card" onclick="fillMessageTemplate('academic')" style="background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); color: white; padding: 1rem; border-radius: 15px; cursor: pointer; transition: transform 0.3s;">
                            <h6><i class="fas fa-chart-line me-2"></i>Academic Progress</h6>
                            <small>Discuss child's academic performance and improvement areas</small>
                        </div>
                        <div class="suggestion-card" onclick="fillMessageTemplate('meeting')" style="background: linear-gradient(135deg, #27ae60 0%, #229954 100%); color: white; padding: 1rem; border-radius: 15px; cursor: pointer; transition: transform 0.3s;">
                            <h6><i class="fas fa-calendar-alt me-2"></i>Schedule Meeting</h6>
                            <small>Request a parent-teacher meeting to discuss important matters</small>
                        </div>
                        <div class="suggestion-card" onclick="fillMessageTemplate('homework')" style="background: linear-gradient(135deg, #e67e22 0%, #d35400 100%); color: white; padding: 1rem; border-radius: 15px; cursor: pointer; transition: transform 0.3s;">
                            <h6><i class="fas fa-tasks me-2"></i>Homework Help</h6>
                            <small>Ask for additional support with homework and assignments</small>
                        </div>
                        <div class="suggestion-card" onclick="fillMessageTemplate('appreciation')" style="background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%); color: white; padding: 1rem; border-radius: 15px; cursor: pointer; transition: transform 0.3s;">
                            <h6><i class="fas fa-heart me-2"></i>Appreciation</h6>
                            <small>Express gratitude and positive feedback to the teacher</small>
                        </div>
                    </div>
                </div>

                <!-- Message Composer -->
                <div class="mb-4">
                    <label for="messageContent" class="form-label fw-bold">
                        <i class="fas fa-edit text-primary me-2"></i>Your Message
                    </label>
                    <textarea id="messageContent" class="form-control" rows="6" placeholder="Type your message here..." style="border-radius: 15px; border: 2px solid #e9ecef; resize: vertical;"></textarea>
                    <div class="character-count mt-2">
                        <small class="text-muted">Characters: <span id="charCount">0</span>/1000</small>
                    </div>
                </div>

                <!-- Language & Translation -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <label class="form-label fw-bold">
                            <i class="fas fa-language text-info me-2"></i>Compose in Your Language
                        </label>
                        <div class="language-buttons d-flex gap-2">
                            <button type="button" class="btn btn-outline-primary language-btn" data-lang="en">English</button>
                            <button type="button" class="btn btn-outline-primary language-btn" data-lang="hi">हिंदी</button>
                            <button type="button" class="btn btn-outline-primary language-btn" data-lang="pa">ਪੰਜਾਬੀ</button>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label fw-bold">
                            <i class="fas fa-clock text-warning me-2"></i>Schedule Message
                        </label>
                        <input type="datetime-local" id="scheduleTime" class="form-control" style="border-radius: 15px; border: 2px solid #e9ecef;">
                        <small class="text-muted">Leave empty to send immediately</small>
                    </div>
                </div>

                <!-- Attachments -->
                <div class="mb-4">
                    <label class="form-label fw-bold">
                        <i class="fas fa-paperclip text-success me-2"></i>Attachments (Optional)
                    </label>
                    <input type="file" id="attachments" class="form-control" multiple accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" style="border-radius: 15px; border: 2px solid #e9ecef;">
                    <small class="text-muted">Max 5 files, 10MB each. Supported: PDF, DOC, Images</small>
                </div>
            </div>
            <div class="modal-footer" style="border-top: 1px solid #e9ecef; border-radius: 0 0 20px 20px;">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="border-radius: 25px;">
                    <i class="fas fa-times me-2"></i>Cancel
                </button>
                <button type="button" class="btn btn-primary" onclick="sendNewMessage()" style="border-radius: 25px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none;">
                    <i class="fas fa-paper-plane me-2"></i>Send Message
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Advanced Search Modal -->
<div class="modal fade" id="advancedSearchModal" tabindex="-1" aria-labelledby="advancedSearchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content" style="border-radius: 20px; border: none;">
            <div class="modal-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 20px 20px 0 0; color: white;">
                <h5 class="modal-title" id="advancedSearchModalLabel">
                    <i class="fas fa-search me-2"></i>Advanced Search & Filter
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-4">
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="searchTeacher" class="form-label">Teacher</label>
                        <select id="searchTeacher" class="form-select">
                            <option value="">All Teachers</option>
                            <option value="math_teacher">Mrs. Sharma - Mathematics</option>
                            <option value="science_teacher">Mr. Kumar - Science</option>
                            <option value="english_teacher">Ms. Patel - English</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label for="searchSubject" class="form-label">Subject Contains</label>
                        <input type="text" id="searchSubject" class="form-control" placeholder="Search in subject...">
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="dateFrom" class="form-label">From Date</label>
                        <input type="date" id="dateFrom" class="form-control">
                    </div>
                    <div class="col-md-6">
                        <label for="dateTo" class="form-label">To Date</label>
                        <input type="date" id="dateTo" class="form-control">
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="searchStatus" class="form-label">Status</label>
                        <select id="searchStatus" class="form-select">
                            <option value="">All Status</option>
                            <option value="unread">Unread Only</option>
                            <option value="read">Read Only</option>
                            <option value="replied">Replied</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label for="searchPriority" class="form-label">Priority</label>
                        <select id="searchPriority" class="form-select">
                            <option value="">All Priorities</option>
                            <option value="urgent">Urgent</option>
                            <option value="high">High</option>
                            <option value="medium">Medium</option>
                            <option value="low">Low</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="applyAdvancedSearch()">Apply Search</button>
            </div>
        </div>
    </div>
</div>

{% endblock %}